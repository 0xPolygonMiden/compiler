export.is_signed
  push.2147483648
  u32.and
  push.2147483648
  eq

end

export.overflowing_add
  u32.assert2
  dup.0
  exec.is_signed
  dup.2
  exec.is_signed
  movup.3
  movup.3
  u32.add.wrapping
  dup.0
  exec.is_signed
  movup.3
  dup.1
  eq
  swap.1
  movup.3
  neq
  and

end

export.checked_add
  exec.overflowing_add
  assertz

end

export.checked_neg
  dup.0
  push.2147483648
  eq
  assertz
  u32.not
  u32.add.wrapping.1

end

export.unchecked_neg
  u32.not
  u32.add.wrapping.1

end

export.unchecked_sub
  u32.not
  add
  incr

end

export.overflowing_sub
  u32.assert2
  dup.0
  exec.is_signed
  dup.2
  exec.is_signed
  movup.3
  movup.3
  u32.sub.wrapping
  dup.0
  exec.is_signed
  movup.3
  dup.1
  eq
  swap.1
  movup.3
  neq
  and

end

export.checked_sub
  exec.overflowing_sub
  assertz

end

export.overflowing_mul
  u32.assert2
  dup.0
  exec.is_signed
  dup.2
  exec.is_signed
  movup.3
  movup.3
  u32.mul.wrapping
  movup.3
  dup.1
  eq
  swap.1
  movup.3
  neq
  and

end

export.checked_mul
  exec.overflowing_mul
  assertz

end

export.checked_div
  u32.assert2
  dup.1
  exec.unchecked_neg
  dup.2
  swap.1
  movup.3
  exec.is_signed
  dup.0
  movdn.4
  cdrop
  dup.1
  exec.unchecked_neg
  dup.2
  swap.1
  movup.3
  exec.is_signed
  dup.0
  movdn.4
  cdrop
  u32.div.unchecked
  movdn.2
  neq
  dup.1
  exec.unchecked_neg
  swap.1
  cdrop

end

export.icmp
  dup.1
  dup.1
  push.2147483648
  u32.and
  swap.1
  push.2147483648
  u32.and
  eq.0
  swap.1
  eq.0
  swap.1
  dup.1
  neq
  if.true
    movdn.2
    drop
    drop
    push.1
    push.4294967295
    swap.2
    cdrop
  else
    drop
    dup.1
    dup.1
    u32.gt.unchecked
    movdn.2
    u32.lt.unchecked
    push.0
    push.4294967295
    push.1
    swap.3
    cdrop
    swap.2
    cdrop
  end

end

export.is_lt
  exec.icmp
  push.4294967295
  eq

end

export.is_lte
  exec.icmp
  neq.1

end

export.is_gt
  exec.icmp
  eq.1

end

export.is_gte
  exec.icmp
  push.4294967295
  neq

end

export.pow2
  dup.0
  push.31
  u32.lt.checked
  assert
  push.1
  swap.1
  u32.shl.checked

end

export.ipow
  dup.0
  eq.0
  dup.2
  eq.0
  or
  if.true
    eq.0
    push.1
    push.0
    swap.2
    cdrop
    swap.1
    drop
  else
    push.1
    dup.1
    push.1
    u32.gt.checked
    while.true
      dup.2
      dup.1
      mul
      dup.2
      push.1
      u32.and
      eq.1
      cdrop
      u32.assert
      swap.1
      u32.div.checked.2
      movup.2
      dup.0
      u32.mul.checked
      swap.1
      movup.2
      dup.1
      push.1
      u32.gt.checked
    end
    swap.1
    drop
    u32.mul.checked
  end

end

export.checked_shr
  dup.0
  push.32
  u32.lt.checked
  assert
  dup.0
  eq.0
  dup.2
  eq.0
  or
  if.true
    eq.0
    swap.1
    push.0
    swap.2
    cdrop
  else
    dup.1
    push.2147483648
    u32.and
    push.2147483648
    eq
    if.true
      swap.1
      dup.1
      u32.shr.checked
      push.1
      dup.2
      u32.shl.unchecked
      sub.1
      push.32
      movup.3
      sub
      u32.shl.unchecked
      u32.or
    else
      u32.shr.checked
    end
  end

end

export.extract_element
  dup.0
  push.3
  lte
  assert
  dup.0
  push.3
  lt
  movdn.5
  dup.0
  push.2
  lt
  movdn.5
  push.1
  lt
  cdrop
  movup.3
  cdrop
  movup.2
  cdrop

end

proc.load_felt_unchecked
  padw
  movup.4
  mem_loadw
  movup.4
  exec.extract_element

end

export.load_felt
  movup.2
  assertz
  exec.load_felt_unchecked

end

export.load_sw
  dup.2
  eq.0
  dup.3
  push.8
  u32.lt.checked
  assert
  if.true
    movup.2
    drop
    exec.load_felt_unchecked
  else
    dup.1
    eq.0
    if.true
      swap.1
      drop
      padw
      movup.4
      mem_loadw
      movup.3
      movup.3
      drop
      drop
      dup.2
      u32.shl.checked
      swap.1
      push.32
      movup.3
      u32.sub.checked
      u32.shr.checked
      u32.or
    else
      dup.1
      eq.1
      if.true
        swap.1
        drop
        padw
        movup.4
        mem_loadw
        drop
        movdn.2
        movdn.2
        drop
        dup.2
        u32.shl.checked
        swap.1
        push.32
        movup.3
        u32.sub.checked
        u32.shr.checked
        u32.or
      else
        swap.1
        eq.2
        if.true
          padw
          movup.4
          mem_loadw
          drop
          drop
          dup.2
          u32.shl.checked
          swap.1
          push.32
          movup.3
          u32.sub.checked
          u32.shr.checked
          u32.or
        else
          dup.0
          u32.add.checked.1
          padw
          movup.4
          mem_loadw
          movdn.4
          drop
          drop
          drop
          push.32
          dup.3
          u32.sub.checked
          u32.shr.checked
          swap.1
          padw
          movup.4
          mem_loadw
          drop
          drop
          drop
          movup.2
          u32.shl.checked
          u32.or
        end
      end
    end
  end

end

export.realign_dw
  dup.3
  u32.shl.checked
  movdn.2
  dup.0
  push.32
  dup.4
  u32.shr.checked
  movup.4
  u32.or
  movdn.2
  dup.3
  u32.shl.checked
  swap.1
  push.32
  movup.4
  u32.shr.checked
  u32.or
  swap.1

end

export.load_dw
  dup.2
  eq.0
  dup.3
  push.8
  u32.lt.checked
  assert
  if.true
    movup.2
    drop
    dup.1
    eq.0
    if.true
      swap.1
      drop
      padw
      movup.4
      mem_loadw
      movup.4
      movup.4
      drop
      drop
    else
      dup.1
      eq.1
      if.true
        swap.1
        drop
        padw
        movup.4
        mem_loadw
        drop
        movup.3
        drop
      else
        swap.1
        eq.2
        if.true
          padw
          movup.4
          mem_loadw
          drop
          drop
        else
          dup.0
          u32.add.checked.1
          padw
          movup.4
          mem_loadw
          movup.4
          movup.4
          movup.4
          drop
          drop
          drop
          movup.4
          padw
          movup.4
          mem_loadw
          drop
          drop
          drop
        end
      end
    end
  else
    dup.1
    eq.0
    if.true
      swap.1
      drop
      padw
      movup.4
      mem_loadw
      movup.4
      drop
      exec.realign_dw
    else
      dup.1
      eq.1
      if.true
        swap.1
        drop
        padw
        movup.4
        mem_loadw
        drop
        exec.realign_dw
      else
        swap.1
        eq.2
        if.true
          dup.0
          u32.add.checked.1
          padw
          movup.4
          mem_loadw
          movup.4
          movup.4
          movup.4
          drop
          drop
          drop
          swap.1
          padw
          movup.4
          mem_loadw
          drop
          drop
          exec.realign_dw
        else
          dup.0
          u32.add.checked.1
          padw
          movup.4
          mem_loadw
          movup.4
          movup.4
          drop
          drop
          movup.2
          padw
          movup.4
          mem_loadw
          drop
          drop
          drop
          exec.realign_dw
        end
      end
    end
  end

end

export.entrypoint
  eqw

end
begin
    exec.entrypoint
end

